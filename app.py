import streamlit as st
import random

# --- ãƒšãƒ¼ã‚¸è¨­å®š ---
st.set_page_config(page_title="uprãƒã‚¹ã‚¿ãƒ¼ã‚¯ã‚¤ã‚º", page_icon="ğŸšš")

# --- 2. ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆï¼ˆå•é¡Œã®è¿½åŠ ãƒ»æ‹¡å……ç‰ˆï¼‰ ---
# ã“ã“ã«ã€Œä¸­ç´šãƒ»ä¸Šç´šãƒ»ãƒãƒ‹ã‚¢ãƒƒã‚¯ã€ãªå•é¡Œã‚’å…¨ã¦æ ¼ç´ã—ã¾ã™
ALL_QUESTIONS = [
    # --- åŸºæœ¬ç·¨ ---
    {
        "category": "åŸºæœ¬",
        "question": "upræ ªå¼ä¼šç¤¾ã®ç¾åœ¨ã®ä»£è¡¨å–ç· å½¹ç¤¾é•·ã¯èª°ï¼Ÿ",
        "options": ["é…’ç”° ä¸‰ç”·", "é…’ç”° ç¾©çŸ¢", "çŸ³æ‘ æµ©", "å¤§åº­ æ­£ä¿¡"],
        "answer": "é…’ç”° ç¾©çŸ¢",
        "explanation": "é…’ç”°ç¾©çŸ¢æ°ãŒä»£è¡¨å–ç· å½¹ç¤¾é•·ã§ã™ã€‚"
    },
    {
        "category": "åŸºæœ¬",
        "question": "uprã®å‰µæ¥­ã®åœ°ã§ã‚ã‚Šã€ç¾åœ¨ã‚‚äºŒæœ¬ç¤¾åˆ¶ã®ä¸€ç¿¼ã‚’æ‹…ã†éƒ½å¸‚ã¯ï¼Ÿ",
        "options": ["æ±äº¬éƒ½åƒä»£ç”°åŒº", "å¤§é˜ªåºœå¤§é˜ªå¸‚", "å±±å£çœŒå®‡éƒ¨å¸‚", "ç¦å²¡çœŒç¦å²¡å¸‚"],
        "answer": "å±±å£çœŒå®‡éƒ¨å¸‚",
        "explanation": "1979å¹´ã«å±±å£çœŒå®‡éƒ¨å¸‚ã§è¨­ç«‹ã•ã‚Œã¾ã—ãŸã€‚"
    },
    # --- äº‹æ¥­ãƒ»ã‚µãƒ¼ãƒ“ã‚¹ç·¨ ---
    {
        "category": "ã‚µãƒ¼ãƒ“ã‚¹",
        "question": "ç‰©æµç¾å ´ã®è² æ‹…ã‚’è»½æ¸›ã™ã‚‹ãŸã‚uprãŒå±•é–‹ã—ã¦ã„ã‚‹ã€Œè£…ç€å‹ãƒ­ãƒœãƒƒãƒˆã€ã®ç·ç§°ã¯ï¼Ÿ",
        "options": ["ãƒ‘ãƒ¯ãƒ¼ãƒ‰ã‚¹ãƒ¼ãƒ„", "ã‚¢ã‚·ã‚¹ãƒˆã‚¹ãƒ¼ãƒ„", "ã‚µã‚¤ãƒœãƒ¼ã‚°ã‚¢ãƒ¼ãƒ ", "ãƒãƒƒã‚¹ãƒ«ã‚¹ãƒ¼ãƒ„"],
        "answer": "ã‚¢ã‚·ã‚¹ãƒˆã‚¹ãƒ¼ãƒ„",
        "explanation": "ã€Œã‚µãƒãƒ¼ãƒˆã‚¸ãƒ£ã‚±ãƒƒãƒˆã€ã‚·ãƒªãƒ¼ã‚ºãªã©ã®ã‚¢ã‚·ã‚¹ãƒˆã‚¹ãƒ¼ãƒ„ã‚’å±•é–‹ã—ã€åŠ´åƒåŠ›ä¸è¶³ã®è§£æ¶ˆã«è²¢çŒ®ã—ã¦ã„ã¾ã™ã€‚"
    },
    {
        "category": "ã‚µãƒ¼ãƒ“ã‚¹",
        "question": "uprã®ç‰©æµIoTã‚µãƒ¼ãƒ“ã‚¹ã§ã€è·ç‰©ã®ä½ç½®ã‚„æ¸©æ¹¿åº¦ã‚’é éš”ç›£è¦–ã§ãã‚‹ã‚·ã‚¹ãƒ†ãƒ ã¯ï¼Ÿ",
        "options": ["ã¿ã¾ã‚‚ã‚Šãã‚“", "ã©ã“ã§ã‚‚ã‚µãƒ¼ãƒ", "ãªã‚“ã¤ã„", "ãƒ­ã‚¸ãƒˆãƒ©ãƒƒã‚«ãƒ¼"],
        "answer": "ãªã‚“ã¤ã„",
        "explanation": "ã€Œãªã‚“ã§ã‚‚è¿½è·¡ã€ã‚’ç•¥ã—ãŸã€ãªã‚“ã¤ã„ã€ã¯ã€GPSç«¯æœ«ã‚’æ´»ç”¨ã—ãŸãƒ­ãƒ³ã‚°ã‚»ãƒ©ãƒ¼å•†å“ã§ã™ã€‚"
    },
    # --- è²¡å‹™ãƒ»IRãƒ»ãƒãƒ‹ã‚¢ãƒƒã‚¯ç·¨ï¼ˆæ–°è¦è¿½åŠ åˆ†ï¼‰ ---
    {
        "category": "è²¡å‹™ãƒ»IR",
        "question": "upræ ªå¼ä¼šç¤¾ã®è¨¼åˆ¸ã‚³ãƒ¼ãƒ‰ã¯ï¼Ÿ",
        "options": ["7065", "9090", "2323", "4649"],
        "answer": "7065",
        "explanation": "æ±äº¬è¨¼åˆ¸å–å¼•æ‰€ï¼ˆã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰å¸‚å ´ï¼‰ã§ã®è¨¼åˆ¸ã‚³ãƒ¼ãƒ‰ã¯ã€Œ7065ã€ã§ã™ã€‚"
    },
    {
        "category": "è²¡å‹™ãƒ»IR",
        "question": "uprã®æ±ºç®—æœŸï¼ˆäº‹æ¥­å¹´åº¦ã®æœ«æ—¥ï¼‰ã¯ä½•æœˆï¼Ÿ",
        "options": ["3æœˆ", "8æœˆ", "9æœˆ", "12æœˆ"],
        "answer": "8æœˆ",
        "explanation": "uprã®æ±ºç®—æœˆã¯8æœˆã§ã™ï¼ˆæ¯å¹´9æœˆ1æ—¥ã€œç¿Œå¹´8æœˆ31æ—¥ï¼‰ã€‚"
    },
    {
        "category": "ãƒãƒ‹ã‚¢ãƒƒã‚¯",
        "question": "uprãŒæä¾›ã™ã‚‹ã‚«ãƒ¼ã‚·ã‚§ã‚¢ãƒªãƒ³ã‚°äºˆç´„ã‚·ã‚¹ãƒ†ãƒ ã®åç§°ã¯ï¼Ÿ",
        "options": ["upr Go", "U-Car", "upr CAR SHARE", "Drive U"],
        "answer": "upr CAR SHARE",
        "explanation": "ç‰©æµæ©Ÿå™¨ã ã‘ã§ãªãã€ã‚«ãƒ¼ã‚·ã‚§ã‚¢ãƒªãƒ³ã‚°ã®ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ æä¾›ã‚‚è¡Œã£ã¦ã„ã¾ã™ã€‚"
    },
    {
        "category": "æ­´å²",
        "question": "uprã®ãƒ«ãƒ¼ãƒ„ã¨ãªã‚‹å‰µæ¥­æ™‚ã®ç¤¾åï¼ˆ1979å¹´è¨­ç«‹æ™‚ï¼‰ã¯ï¼Ÿ",
        "options": ["ã‚¦ãƒ™ãƒ‘ãƒ¬ãƒƒãƒˆæ ªå¼ä¼šç¤¾", "å±±å£ç‰©æµãƒ¬ãƒ³ã‚¿ãƒ«", "é…’ç”°ææœ¨åº—", "ãƒ¦ãƒ¼ãƒ”ãƒ¼ã‚¢ãƒ¼ãƒ«ãƒ»ãƒ­ã‚¸ã‚¹ãƒ†ã‚£ã‚¯ã‚¹"],
        "answer": "ã‚¦ãƒ™ãƒ‘ãƒ¬ãƒƒãƒˆæ ªå¼ä¼šç¤¾",
        "explanation": "ã€Œã‚¦ãƒ™ãƒ‘ãƒ¬ãƒƒãƒˆæ ªå¼ä¼šç¤¾ã€ã¨ã—ã¦è¨­ç«‹ã•ã‚Œã€ãã®å¾Œå•†å·å¤‰æ›´ã‚’çµŒã¦ç¾åœ¨ã®uprã«ãªã‚Šã¾ã—ãŸã€‚"
    },
    {
        "category": "CSR",
        "question": "uprãŒæ¨é€²ã™ã‚‹ã€Œãƒ‘ãƒ¬ãƒƒãƒˆãƒ—ãƒ¼ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã€ãŒç’°å¢ƒã«è²¢çŒ®ã™ã‚‹æœ€å¤§ã®ç†ç”±ã¯ï¼Ÿ",
        "options": ["æœ¨æã‚’å…¨ãä½¿ã‚ãªã„ã‹ã‚‰", "ç©ºè»Šã§ã®å›åè¼¸é€ï¼ˆç©ºè·èµ°è¡Œï¼‰ã‚’å‰Šæ¸›ã§ãã‚‹ã‹ã‚‰", "ãƒ‘ãƒ¬ãƒƒãƒˆãŒç©ºæ°—ã‚’æµ„åŒ–ã™ã‚‹ã‹ã‚‰", "å…¨ã¦é›»æ°—è‡ªå‹•è»Šã§é‹ã¶ã‹ã‚‰"],
        "answer": "ç©ºè»Šã§ã®å›åè¼¸é€ï¼ˆç©ºè·èµ°è¡Œï¼‰ã‚’å‰Šæ¸›ã§ãã‚‹ã‹ã‚‰",
        "explanation": "ãƒ¬ãƒ³ã‚¿ãƒ«æ–¹å¼ã§å…±æœ‰ãƒ»å›åã™ã‚‹ã“ã¨ã§ã€è‡ªç¤¾ã§å›åã™ã‚‹æ‰‹é–“ã¨ãƒˆãƒ©ãƒƒã‚¯ã®CO2æ’å‡ºã‚’å‰Šæ¸›ã—ã¾ã™ï¼ˆã€Œæ¨™æº–åŒ–ã€ã¨ã€Œå…±åŒåˆ©ç”¨ã€ã®åŠ¹æœï¼‰ã€‚"
    }
]

# --- 3. ã‚¢ãƒ—ãƒªã®ãƒ­ã‚¸ãƒƒã‚¯ ---

def init_game():
    """ã‚²ãƒ¼ãƒ ã®åˆæœŸåŒ–å‡¦ç†"""
    st.session_state["score"] = 0
    st.session_state["current_q_index"] = 0
    st.session_state["finished"] = False
    # å•é¡Œã‚’ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã—ã¦ã‚»ãƒƒãƒˆï¼ˆæ¯å›é•ã†é †åºã§å‡ºé¡Œï¼‰
    st.session_state["questions"] = random.sample(ALL_QUESTIONS, len(ALL_QUESTIONS))

# ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã®åˆæœŸç¢ºèª
if "questions" not in st.session_state:
    init_game()

# --- ç”»é¢è¡¨ç¤º ---

st.title("ğŸšš upr ä¼æ¥­æƒ…å ±ãƒã‚¹ã‚¿ãƒ¼ã‚¯ã‚¤ã‚º")

# ã‚¯ã‚¤ã‚ºçµ‚äº†æ™‚ã®ç”»é¢
if st.session_state["finished"]:
    st.balloons()
    score = st.session_state["score"]
    total = len(st.session_state["questions"])
    
    st.header(f"çµæœç™ºè¡¨ï¼")
    st.markdown(f"ã‚ãªãŸã®ã‚¹ã‚³ã‚¢ã¯... **{total}å•ä¸­ {score}å• æ­£è§£** ã§ã™ï¼")
    
    if score == total:
        st.success("ç´ æ™´ã‚‰ã—ã„ï¼ã‚ãªãŸã¯çœŸã®uprãƒã‚¹ã‚¿ãƒ¼ã§ã™ï¼ğŸ‘‘")
    elif score >= total * 0.7:
        st.info("ãŠã—ã„ï¼ã‹ãªã‚Šã®upré€šã§ã™ã­ã€‚")
    else:
        st.warning("ã‚‚ã†å°‘ã—ï¼Webã‚µã‚¤ãƒˆã‚’è¦‹ã¦å¾©ç¿’ã—ã¾ã—ã‚‡ã†ã€‚")
    
    if st.button("ã‚‚ã†ä¸€åº¦æŒ‘æˆ¦ã™ã‚‹"):
        init_game()
        st.rerun()

# ã‚¯ã‚¤ã‚ºé€²è¡Œä¸­ã®ç”»é¢
else:
    # ç¾åœ¨ã®å•é¡Œã‚’å–å¾—
    idx = st.session_state["current_q_index"]
    q_data = st.session_state["questions"][idx]
    
    # ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼
    st.progress((idx) / len(st.session_state["questions"]))
    st.markdown(f"**ç¬¬ {idx + 1} å•** [{q_data['category']}]")
    
    st.subheader(q_data["question"])
    
    # ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å›ç­”é¸æŠï¼ˆãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ï¼‰
    # keyã«indexã‚’å…¥ã‚Œã‚‹ã“ã¨ã§ã€å‰ã®å›ç­”ãŒæ®‹ã‚‰ãªã„ã‚ˆã†ã«ã™ã‚‹
    user_choice = st.radio("é¸æŠè‚¢:", q_data["options"], key=f"q_{idx}")
    
    # å›ç­”ãƒœã‚¿ãƒ³
    if st.button("å›ç­”ã™ã‚‹"):
        # æ­£èª¤åˆ¤å®šç”¨ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’ä½œæˆ
        result_container = st.container()
        
        if user_choice == q_data["answer"]:
            st.session_state["score"] += 1
            result_container.success(f"æ­£è§£ï¼ ğŸ‰")
        else:
            result_container.error(f"ä¸æ­£è§£... ğŸ˜¢")
        
        # è§£èª¬ã‚’è¡¨ç¤º
        result_container.info(f"**æ­£è§£:** {q_data['answer']}\n\n**è§£èª¬:** {q_data['explanation']}")
        
        # ã€Œæ¬¡ã¸ã€ãƒœã‚¿ãƒ³ã®ä»£ã‚ã‚Šã«ä¸€æ™‚åœæ­¢ã‚’å…¥ã‚Œã‚‹ã‹ã€
        # ã“ã“ã§ã¯ã‚·ãƒ³ãƒ—ãƒ«ã«çµæœã‚’è¦‹ãŸå¾Œã«ãƒœã‚¿ãƒ³ã‚’æŠ¼ã•ã›ã‚‹ãƒ•ãƒ­ãƒ¼ã«ã—ã¾ã™ã€‚
        # Streamlitã®ä»•æ§˜ä¸Šã€ãƒœã‚¿ãƒ³ã®ä¸­ã«ãƒœã‚¿ãƒ³ã¯ç½®ã‘ãªã„ãŸã‚ã€
        # session_stateã‚’ä½¿ã£ã¦ã€Œå›ç­”æ¸ˆã¿ã€ãƒ•ãƒ©ã‚°ã‚’ç®¡ç†ã™ã‚‹æ–¹æ³•ã‚‚ã‚ã‚Šã¾ã™ãŒã€
        # ä»Šå›ã¯ã‚·ãƒ³ãƒ—ãƒ«ã«ã€Œæ¬¡ã®å•é¡Œã¸é€²ã‚€ã€ãƒœã‚¿ãƒ³ã‚’ä¸‹ã«è¡¨ç¤ºã—ã¾ã™ã€‚
        
        # å®Ÿéš›ã«ã¯ã€Œå›ç­”ã™ã‚‹ã€ã‚’æŠ¼ã—ãŸç¬é–“ã«ç”»é¢ãŒæ›´æ–°ã•ã‚Œã‚‹ãŸã‚ã€
        # è§£èª¬ã‚’èª­ã¾ã›ã‚‹ãŸã‚ã«ä¸€æ™‚çš„ã«flowã‚’æ­¢ã‚ã‚‹å·¥å¤«ãŒå¿…è¦ã§ã™ãŒã€
        # ç°¡æ˜“ç‰ˆã¨ã—ã¦ã€å›ç­”ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨åŒæ™‚ã«æ¬¡ã®å•é¡Œã¸ã®é·ç§»ãƒœã‚¿ãƒ³ãŒå‡ºã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

    # (ç°¡æ˜“å®Ÿè£…) è§£èª¬ã‚’ã˜ã£ãã‚Šèª­ã¿ãŸã„å ´åˆã¯UIå·¥å¤«ãŒå¿…è¦ã§ã™ãŒã€
    # ã“ã“ã§ã¯ã€Œå›ç­”æ¸ˆã¿ãªã‚‰æ¬¡ã¸ãƒœã‚¿ãƒ³ã‚’å‡ºã™ã€å‡¦ç†ã‚’æ¨¡æ“¬çš„ã«æ›¸ãã¾ã™ã€‚
    # å³å¯†ã«ã¯ã€Œå›ç­”ãƒœã‚¿ãƒ³ã€ã‚’æŠ¼ã—ãŸå¾Œã®å†æç”»ã§ã“ã“ã‚’åˆ¶å¾¡ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
    
    # â˜…ã‚ˆã‚Šã‚¹ãƒ ãƒ¼ã‚ºãªUIã®ãŸã‚ã®ä¿®æ­£æ¡ˆï¼š
    # ãƒ•ã‚©ãƒ¼ãƒ ã‚’ä½¿ã£ã¦submitãƒœã‚¿ãƒ³ã§åˆ¤å®šã—ã€session_stateã«ã€Œè§£èª¬è¡¨ç¤ºä¸­ãƒ•ãƒ©ã‚°ã€ã‚’ç«‹ã¦ã‚‹ã®ãŒãƒ™ã‚¹ãƒˆã§ã™ã€‚
    # ä»Šå›ã¯ã‚³ãƒ¼ãƒ‰ãŒè¤‡é›‘ã«ãªã‚Šã™ããªã„ã‚ˆã†ã€ã‚¹ãƒ†ãƒƒãƒ—ã‚’åˆ†ã‘ã¾ã™ã€‚

    if st.button("æ¬¡ã®å•é¡Œã¸ï¼ˆã¾ãŸã¯çµæœã‚’ç¢ºèªï¼‰"):
        # æœ€å¾Œã®å•é¡Œã ã£ãŸã‚‰çµ‚äº†ãƒ•ãƒ©ã‚°ã‚’ç«‹ã¦ã‚‹
        if idx + 1 >= len(st.session_state["questions"]):
            st.session_state["finished"] = True
        else:
            st.session_state["current_q_index"] += 1
        st.rerun()

    st.caption("â€»ã€Œå›ç­”ã™ã‚‹ã€ã‚’æŠ¼ã—ã¦æ­£èª¤ã‚’ç¢ºèªã—ã¦ã‹ã‚‰ã€ã€Œæ¬¡ã®å•é¡Œã¸ã€ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚")