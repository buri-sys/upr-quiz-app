import streamlit as st
import random

# --- ãƒšãƒ¼ã‚¸è¨­å®š ---
st.set_page_config(
    page_title="UPRãƒã‚¹ã‚¿ãƒ¼ã‚¯ã‚¤ã‚º", 
    page_icon="ğŸšš",
    layout="wide"
)

# --- 1. åŸºæœ¬å•é¡Œãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆï¼ˆãƒã‚¿å¸³ï¼‰ ---
# ã“ã“ã«å®šç¾©ã—ãŸã€Œ1ã¤ã®ãƒã‚¿ã€ã‹ã‚‰ã€è¤‡æ•°ã®å‡ºé¡Œãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ç”Ÿæˆã—ã¾ã™ã€‚
# åˆ†é‡ï¼ˆIRã€æ­´å²ã€ã‚µãƒ¼ãƒ“ã‚¹ã€ãƒˆãƒªãƒ“ã‚¢ãªã©ï¼‰ã‚’å¤§å¹…ã«æ‹¡å……ã—ã¾ã—ãŸã€‚

BASE_QUESTIONS = [
    # --- çµŒå–¶ãƒ»åŸºæœ¬æƒ…å ± ---
    {"c": "çµŒå–¶", "q": "UPRã®ç¾åœ¨ã®ä»£è¡¨å–ç· å½¹ç¤¾é•·ã¯ï¼Ÿ", "a": "é…’ç”° ç¾©çŸ¢", "o": ["é…’ç”° ä¸‰ç”·", "é…’ç”° ç¾©çŸ¢", "çŸ³æ‘ æµ©", "å¤§åº­ æ­£ä¿¡"], "e": "é…’ç”°ç¾©çŸ¢æ°ãŒä»£è¡¨å–ç· å½¹ç¤¾é•·ã§ã™ã€‚"},
    {"c": "çµŒå–¶", "q": "UPRã®å‰µæ¥­ã®åœ°ã¯ï¼Ÿ", "a": "å±±å£çœŒå®‡éƒ¨å¸‚", "o": ["æ±äº¬éƒ½åƒä»£ç”°åŒº", "å¤§é˜ªåºœå¤§é˜ªå¸‚", "å±±å£çœŒå®‡éƒ¨å¸‚", "ç¦å²¡çœŒç¦å²¡å¸‚"], "e": "1979å¹´ã«å±±å£çœŒå®‡éƒ¨å¸‚ã§è¨­ç«‹ã•ã‚Œã¾ã—ãŸã€‚"},
    {"c": "çµŒå–¶", "q": "UPRã®è¨¼åˆ¸ã‚³ãƒ¼ãƒ‰ã¯ï¼Ÿ", "a": "7065", "o": ["7065", "9090", "2323", "4649"], "e": "æ±è¨¼ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰å¸‚å ´ã§ã®ã‚³ãƒ¼ãƒ‰ã¯7065ã§ã™ã€‚"},
    {"c": "çµŒå–¶", "q": "UPRã®æ±ºç®—æœˆï¼ˆäº‹æ¥­å¹´åº¦æœ«ï¼‰ã¯ï¼Ÿ", "a": "8æœˆ", "o": ["3æœˆ", "8æœˆ", "9æœˆ", "12æœˆ"], "e": "8æœˆæ±ºç®—ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚"},
    {"c": "çµŒå–¶", "q": "UPRã®æ±äº¬æœ¬ç¤¾ã®æ‰€åœ¨åœ°ã¯ï¼Ÿ", "a": "åƒä»£ç”°åŒº", "o": ["æ¸¯åŒº", "åƒä»£ç”°åŒº", "æ–°å®¿åŒº", "å“å·åŒº"], "e": "å†…å¹¸ç”ºæ±æ€¥ãƒ“ãƒ«ï¼ˆåƒä»£ç”°åŒºï¼‰ã«ã‚ã‚Šã¾ã™ã€‚"},
    {"c": "çµŒå–¶", "q": "UPRã¸ã®ç¤¾åå¤‰æ›´ãŒè¡Œã‚ã‚ŒãŸã®ã¯è¥¿æš¦ä½•å¹´ï¼Ÿ", "a": "2007å¹´", "o": ["2000å¹´", "2007å¹´", "2015å¹´", "2019å¹´"], "e": "æ—§ç¤¾åã€Œã‚¦ãƒ™ãƒ‘ãƒ¬ãƒƒãƒˆãƒ¬ãƒ³ã‚¿ãƒ«ãƒªãƒ¼ã‚·ãƒ³ã‚°ã€ã‹ã‚‰å¤‰æ›´ã•ã‚Œã¾ã—ãŸã€‚"},
    {"c": "çµŒå–¶", "q": "UPRãŒæ²ã’ã‚‹ã‚¹ãƒ­ãƒ¼ã‚¬ãƒ³ã€Œâ—‹â—‹ Sharing Supporterã€ã€‚â—‹â—‹ã¯ï¼Ÿ", "a": "Social", "o": ["Value", "Social", "Global", "Logistics"], "e": "ã€Œç¤¾ä¼šã®ã‚¤ãƒ³ãƒ•ãƒ©ã‚’ã‚·ã‚§ã‚¢ã™ã‚‹UPRã€ã‚’ç›®æŒ‡ã—ã¦ã„ã¾ã™ã€‚"},

    # --- äº‹æ¥­ãƒ»ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆç‰©æµï¼‰ ---
    {"c": "äº‹æ¥­", "q": "UPRã®å£²ä¸Šã®ç´„9å‰²ã‚’å ã‚ã‚‹ä¸»åŠ›äº‹æ¥­ã¯ï¼Ÿ", "a": "ãƒ‘ãƒ¬ãƒƒãƒˆãƒ»ç‰©æµæ©Ÿå™¨ã®ãƒ¬ãƒ³ã‚¿ãƒ«", "o": ["ã‚¢ã‚·ã‚¹ãƒˆã‚¹ãƒ¼ãƒ„è²©å£²", "ã‚«ãƒ¼ã‚·ã‚§ã‚¢ãƒªãƒ³ã‚°", "ãƒ‘ãƒ¬ãƒƒãƒˆãƒ»ç‰©æµæ©Ÿå™¨ã®ãƒ¬ãƒ³ã‚¿ãƒ«", "å€‰åº«é‹å–¶"], "e": "å‰µæ¥­ä»¥æ¥ã®ã‚³ã‚¢ãƒ“ã‚¸ãƒã‚¹ã§ã™ã€‚"},
    {"c": "äº‹æ¥­", "q": "UPRãŒä¿æœ‰ã™ã‚‹ãƒ¬ãƒ³ã‚¿ãƒ«ãƒ‘ãƒ¬ãƒƒãƒˆã®æšæ•°ã¯ï¼Ÿ", "a": "ç´„510ä¸‡æš", "o": ["ç´„100ä¸‡æš", "ç´„510ä¸‡æš", "ç´„300ä¸‡æš", "ç´„1000ä¸‡æš"], "e": "æ¥­ç•Œãƒˆãƒƒãƒ—ã‚¯ãƒ©ã‚¹ã®ä¿æœ‰æšæ•°ã§ã™ï¼ˆ2024å¹´æ™‚ç‚¹ï¼‰ã€‚"},
    {"c": "äº‹æ¥­", "q": "ãƒ‘ãƒ¬ãƒƒãƒˆãƒ¬ãƒ³ã‚¿ãƒ«ã®ä¿ç®¡ãƒ»ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æ‹ ç‚¹ã®å‘¼ã³åã¯ï¼Ÿ", "a": "ãƒ‡ãƒ", "o": ["ã‚¹ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³", "ãƒ™ãƒ¼ã‚¹", "ãƒ‡ãƒ", "ãƒãƒ–"], "e": "å…¨å›½ã«ç´„200ã‚«æ‰€ã®ãƒ‡ãƒãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãŒã‚ã‚Šã¾ã™ã€‚"},
    {"c": "äº‹æ¥­", "q": "UPRã®ãƒ¬ãƒ³ã‚¿ãƒ«ãƒ‘ãƒ¬ãƒƒãƒˆã§ä¸»åŠ›ã¨ãªã£ã¦ã„ã‚‹æè³ªã¯ï¼Ÿ", "a": "ãƒ—ãƒ©ã‚¹ãƒãƒƒã‚¯", "o": ["æœ¨æ", "é‡‘å±", "ãƒ—ãƒ©ã‚¹ãƒãƒƒã‚¯", "ç´™"], "e": "è€ä¹…æ€§ã¨è¡›ç”Ÿé¢ã«å„ªã‚ŒãŸãƒ—ãƒ©ã‚¹ãƒãƒƒã‚¯è£½ãŒä¸­å¿ƒã§ã™ã€‚"},
    {"c": "äº‹æ¥­", "q": "æ¨™æº–çš„ãªã€Œã‚¤ãƒã‚¤ãƒãƒ‘ãƒ¬ãƒƒãƒˆã€ã®ã‚µã‚¤ã‚ºã¯ï¼Ÿ", "a": "1100Ã—1100mm", "o": ["1200Ã—800mm", "1100Ã—1100mm", "1000Ã—1200mm", "1200Ã—1000mm"], "e": "æ—¥æœ¬å›½å†…ã§æœ€ã‚‚æ±ç”¨çš„ãªã‚µã‚¤ã‚ºã§ã™ã€‚"},
    
    # --- äº‹æ¥­ãƒ»ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆã‚³ãƒã‚¯ãƒ†ã‚£ãƒƒãƒ‰ãƒ»IoTï¼‰ ---
    {"c": "IoT", "q": "ä½œæ¥­è² è·ã‚’è»½æ¸›ã™ã‚‹UPRã®è£…ç€å‹æ©Ÿå™¨ã®ç·ç§°ã¯ï¼Ÿ", "a": "ã‚¢ã‚·ã‚¹ãƒˆã‚¹ãƒ¼ãƒ„", "o": ["ãƒ‘ãƒ¯ãƒ¼ãƒ‰ã‚¹ãƒ¼ãƒ„", "ã‚¢ã‚·ã‚¹ãƒˆã‚¹ãƒ¼ãƒ„", "ãƒ­ãƒœãƒƒãƒˆã‚¢ãƒ¼ãƒ ", "å¼·åŒ–å¤–éª¨æ ¼"], "e": "ã€Œã‚µãƒãƒ¼ãƒˆã‚¸ãƒ£ã‚±ãƒƒãƒˆã€ã‚·ãƒªãƒ¼ã‚ºã‚’å±•é–‹ã—ã¦ã„ã¾ã™ã€‚"},
    {"c": "IoT", "q": "ä½ç½®ãƒ»æ¸©æ¹¿åº¦ã‚’é éš”ç›£è¦–ã§ãã‚‹ç‰©æµIoTã‚µãƒ¼ãƒ“ã‚¹ã¯ï¼Ÿ", "a": "ãªã‚“ã¤ã„", "o": ["ã¿ã¾ã‚‚ã‚Šãã‚“", "ãªã‚“ã¤ã„", "ã©ã“ã§ã‚‚ã‚µãƒ¼ãƒ", "ãƒ­ã‚¸ãƒ“ã‚¸ãƒ§ãƒ³"], "e": "ã€Œãªã‚“ã§ã‚‚è¿½è·¡ã€ã®ç•¥ç§°ã§ã™ã€‚"},
    {"c": "IoT", "q": "RFIDã‚¿ã‚°ã‚’æ­è¼‰ã—ã€åœ¨åº«ç®¡ç†ã‚’åŠ¹ç‡åŒ–ã™ã‚‹ãƒ‘ãƒ¬ãƒƒãƒˆã¯ï¼Ÿ", "a": "ã‚¹ãƒãƒ¼ãƒˆãƒ‘ãƒ¬ãƒƒãƒˆ", "o": ["ãƒ‡ã‚¸ãƒ‘ãƒ¬ãƒƒãƒˆ", "ã‚¹ãƒãƒ¼ãƒˆãƒ‘ãƒ¬ãƒƒãƒˆ", "AIãƒ‘ãƒ¬ãƒƒãƒˆ", "ã‚µã‚¤ãƒãƒ¼ãƒ‘ãƒ¬ãƒƒãƒˆ"], "e": "æ£šå¸ã—ã®è‡ªå‹•åŒ–ãªã©ã‚’å®Ÿç¾ã™ã‚‹DXè£½å“ã§ã™ã€‚"},
    {"c": "IoT", "q": "HACCPæ³•åˆ¶åŒ–ã«å¯¾å¿œã—ãŸè¡›ç”Ÿç®¡ç†IoTãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯ï¼Ÿ", "a": "UPR HACCP", "o": ["Clean Log", "UPR HACCP", "Food Keeper", "è¡›ç”Ÿãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼"], "e": "æ¸©åº¦ç®¡ç†ã¨è¨˜éŒ²ã‚’è‡ªå‹•åŒ–ã™ã‚‹ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ã€‚"},
    {"c": "IoT", "q": "ã‚¹ãƒãƒ›ã®å†™çœŸã§ãƒ‘ãƒ¬ãƒƒãƒˆæšæ•°ã‚’æ•°ãˆã‚‹ã‚¢ãƒ—ãƒªã¯ï¼Ÿ", "a": "ãƒ‘ãƒ¬ãƒƒãƒˆãƒ•ã‚¡ã‚¤ãƒ³ãƒ€ãƒ¼", "o": ["ãƒ‘ãƒ¬ãƒƒãƒˆã‚«ã‚¦ãƒ³ã‚¿ãƒ¼", "æ•°ãˆãƒ«ãƒ³", "ãƒ‘ãƒ¬ãƒƒãƒˆãƒ•ã‚¡ã‚¤ãƒ³ãƒ€ãƒ¼", "AIãƒã‚§ãƒƒã‚«ãƒ¼"], "e": "ç”»åƒèªè­˜AIã‚’æ´»ç”¨ã—ã€ç¬æ™‚ã«æšæ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆã—ã¾ã™ã€‚"},
    {"c": "IoT", "q": "å›½éš›è¼¸é€ã®è¿½è·¡ã«ç‰¹åŒ–ã—ãŸã‚µãƒ¼ãƒ“ã‚¹ã¯ï¼Ÿ", "a": "ãƒ¯ãƒ¼ãƒ«ãƒ‰ã‚­ãƒ¼ãƒ‘ãƒ¼", "o": ["ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¢ã‚¤", "ãƒ¯ãƒ¼ãƒ«ãƒ‰ã‚­ãƒ¼ãƒ‘ãƒ¼", "æµ·å¤–ãªã‚“ã¤ã„", "ã‚ªãƒ¼ã‚·ãƒ£ãƒ³ãƒ“ãƒ¥ãƒ¼"], "e": "å›½ã‚’ã¾ãŸãè¼¸é€ã®ä½ç½®ãƒ»çŠ¶æ…‹ç›£è¦–ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚"},
    {"c": "IoT", "q": "ç‰›ã®ç™ºæƒ…æ¤œçŸ¥ã‚·ã‚¹ãƒ†ãƒ ã®åç§°ã¯ï¼Ÿ", "a": "ç‰›æ¸©æµ", "o": ["ãƒ¢ãƒ¼ãƒ¢ãƒ¼ã‚µãƒ¼ãƒ", "ç‰›æ¸©æµ", "ã‚­ãƒ£ãƒˆãƒ«ã‚³ãƒ¼ãƒ«", "ãƒ•ã‚¡ãƒ¼ãƒ ã‚¦ã‚©ãƒƒãƒ"], "e": "ã€Œã†ã—ãŠã‚“ã‘ã„ã€ã¨èª­ã¿ã€ç•œç”£è¾²å®¶ã‚’æ”¯æ´ã—ã¾ã™ã€‚"},
    {"c": "IoT", "q": "ã€Œãªã‚“ã¤ã„ã€ã®é€šä¿¡æ–¹å¼ã¨ã—ã¦åˆ©ç”¨ã•ã‚Œã‚‹ã®ã¯ï¼Ÿ", "a": "GPS/LTE", "o": ["5Gã®ã¿", "GPS/LTE", "èµ¤å¤–ç·š", "éŸ³æ³¢"], "e": "åºƒåŸŸã§ã®è¿½è·¡ã«æºå¸¯é›»è©±ç¶²ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚"},

    # --- æ­´å²ãƒ»ã‚°ãƒ­ãƒ¼ãƒãƒ« ---
    {"c": "æ­´å²", "q": "å‰µæ¥­å®¶ã§ã‚ã‚‹é…’ç”°å®¶ã®åˆä»£ç¤¾é•·ã¯ï¼Ÿ", "a": "é…’ç”° ä¸‰ç”·", "o": ["é…’ç”° ç¾©çŸ¢", "é…’ç”° ä¸‰ç”·", "é…’ç”° å¥æ²»", "é…’ç”° å¤ªéƒ"], "e": "1979å¹´ã®è¨­ç«‹æ™‚ã«å°±ä»»ã—ã¾ã—ãŸã€‚"},
    {"c": "æ­´å²", "q": "UPRãŒä¸Šå ´ã—ãŸã®ã¯è¥¿æš¦ä½•å¹´ï¼Ÿ", "a": "2019å¹´", "o": ["2015å¹´", "2019å¹´", "2021å¹´", "2000å¹´"], "e": "2019å¹´ã«æ±è¨¼äºŒéƒ¨ã«ä¸Šå ´ã—ã¾ã—ãŸã€‚"},
    {"c": "æµ·å¤–", "q": "UPRãŒæœ€åˆã«æµ·å¤–é€²å‡ºã—ãŸå›½ã¯ï¼Ÿ", "a": "ã‚·ãƒ³ã‚¬ãƒãƒ¼ãƒ«", "o": ["ã‚¿ã‚¤", "ã‚·ãƒ³ã‚¬ãƒãƒ¼ãƒ«", "ãƒãƒ¬ãƒ¼ã‚·ã‚¢", "ãƒ™ãƒˆãƒŠãƒ "], "e": "2011å¹´ã«ç¾åœ°æ³•äººã‚’è¨­ç«‹ã—ã¾ã—ãŸã€‚"},
    {"c": "æµ·å¤–", "q": "ã‚¿ã‚¤ã®ç¾åœ°æ³•äººåã¯ï¼Ÿ", "a": "UPR (Thailand) Co.,Ltd.", "o": ["UPR Siam", "UPR (Thailand) Co.,Ltd.", "Thai Palette", "UPR Bangkok"], "e": "2014å¹´ã«è¨­ç«‹ã•ã‚Œã¾ã—ãŸã€‚"},

    # --- CSRãƒ»IRãƒ»ãƒˆãƒªãƒ“ã‚¢ ---
    {"c": "CSR", "q": "ãƒ‘ãƒ¬ãƒƒãƒˆãƒ—ãƒ¼ãƒ«ã‚·ã‚¹ãƒ†ãƒ ãŒå‰Šæ¸›ã«è²¢çŒ®ã™ã‚‹ã‚‚ã®ã¯ï¼Ÿ", "a": "CO2æ’å‡ºé‡ï¼ˆç©ºè·èµ°è¡Œï¼‰", "o": ["å€‰åº«ã®é›»æ°—ä»£", "CO2æ’å‡ºé‡ï¼ˆç©ºè·èµ°è¡Œï¼‰", "ãƒˆãƒ©ãƒƒã‚¯ã®è£½é€ è²»", "äººä»¶è²»"], "e": "å…±åŒå›åã«ã‚ˆã‚Šã€ãƒˆãƒ©ãƒƒã‚¯ã®ç©ºè·èµ°è¡Œã‚’æ¸›ã‚‰ã—ã¾ã™ã€‚"},
    {"c": "è©³ç´°", "q": "UPRã®Webã‚µã‚¤ãƒˆãƒ‰ãƒ¡ã‚¤ãƒ³ã¯ï¼Ÿ", "a": "upr-net.co.jp", "o": ["upr.co.jp", "upr-net.co.jp", "upr-group.com", "upr-logi.jp"], "e": "å…¬å¼ã‚µã‚¤ãƒˆã¯ upr-net.co.jp ã§ã™ã€‚"},
    {"c": "è©³ç´°", "q": "UPRã®ã‚«ãƒ¼ã‚·ã‚§ã‚¢ãƒªãƒ³ã‚°æ”¯æ´ã‚·ã‚¹ãƒ†ãƒ ã®éµç®¡ç†BOXã¯ï¼Ÿ", "a": "ã‚¹ãƒãƒ¼ãƒˆã‚­ãƒ¼ãƒœãƒƒã‚¯ã‚¹", "o": ["ã‚­ãƒ¼ã‚­ãƒ¼ãƒ‘ãƒ¼", "ã‚¹ãƒãƒ¼ãƒˆã‚­ãƒ¼ãƒœãƒƒã‚¯ã‚¹", "ãƒ­ãƒƒã‚¯ãƒã‚¹ã‚¿ãƒ¼", "ã‚ªãƒ¼ãƒ—ãƒ³ã‚»ã‚µãƒŸ"], "e": "éå¯¾é¢ã§ã®éµã®å—ã‘æ¸¡ã—ã‚’å¯èƒ½ã«ã—ã¾ã™ã€‚"},
    {"c": "è©³ç´°", "q": "UPRã®ã€Œã‚¢ã‚¯ãƒ†ã‚£ãƒ–RFIDã€ã®æœ€å¤§ã®ç‰¹å¾´ã¯ï¼Ÿ", "a": "é›»æ± å†…è”µã§é€šä¿¡è·é›¢ãŒé•·ã„", "o": ["é›»æ± ä¸è¦", "é€šä¿¡è·é›¢ãŒæ•°ãƒŸãƒª", "é›»æ± å†…è”µã§é€šä¿¡è·é›¢ãŒé•·ã„", "æ°´ä¸­å°‚ç”¨"], "e": "è‡ªã‚‰é›»æ³¢ã‚’ç™ºã™ã‚‹ãŸã‚ã€åºƒç¯„å›²ã§ã®æ¤œçŸ¥ãŒå¯èƒ½ã§ã™ã€‚"},
    {"c": "è©³ç´°", "q": "UPRã®ãƒ‘ãƒ¬ãƒƒãƒˆãƒ¬ãƒ³ã‚¿ãƒ«ã®å¥‘ç´„å½¢æ…‹ã®ç‰¹å¾´ã¯ï¼Ÿ", "a": "å¿…è¦ãªæ™‚ã«å¿…è¦ãªæšæ•°ã ã‘", "o": ["å¿…ãš3å¹´å¥‘ç´„", "è²·å–å¿…é ˆ", "å¿…è¦ãªæ™‚ã«å¿…è¦ãªæšæ•°ã ã‘", "æœ€ä½1ä¸‡æšã‹ã‚‰"], "e": "æ³¢å‹•å¯¾å¿œãŒã—ã‚„ã™ã„æŸ”è»Ÿãªãƒ¬ãƒ³ã‚¿ãƒ«æ–¹å¼ã§ã™ã€‚"},
    {"c": "è©³ç´°", "q": "UPRã®ãƒ‘ãƒ¬ãƒƒãƒˆã®è‰²ã¨ã—ã¦ä¸€èˆ¬çš„ãªã®ã¯ï¼Ÿ", "a": "é»’ã‚„æ·±ç·‘ãªã©ã®æ¿ƒè‰²", "o": ["ç™½", "ãƒ”ãƒ³ã‚¯", "é€æ˜", "é»’ã‚„æ·±ç·‘ãªã©ã®æ¿ƒè‰²"], "e": "å†ç”Ÿæã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ãŒå¤šãã€æ±šã‚Œã‚‚ç›®ç«‹ã¡ã«ãã„è‰²ãŒæ¡ç”¨ã•ã‚Œã¾ã™ã€‚"},
    {"c": "è©³ç´°", "q": "UPRã®é€£çµå¾“æ¥­å“¡æ•°è¦æ¨¡ã¯ï¼Ÿï¼ˆ2024å¹´ï¼‰", "a": "200åå°", "o": ["50åä»¥ä¸‹", "200åå°", "1000åä»¥ä¸Š", "1ä¸‡åä»¥ä¸Š"], "e": "å°‘æ•°ç²¾é‹­ã§é«˜åç›Šãªäº‹æ¥­ã‚’å±•é–‹ã—ã¦ã„ã¾ã™ã€‚"},
]

# --- 2. å•é¡Œç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯ï¼ˆãƒˆãƒ”ãƒƒã‚¯IDç®¡ç†ç‰ˆï¼‰ ---
# ãƒã‚¿ï¼ˆTopicï¼‰ã”ã¨ã«ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã—ã¦ç®¡ç†ã—ã€é‡è¤‡å‡ºé¡Œã‚’é˜²ãã¾ã™ã€‚

def create_question_groups(base_list):
    """
    åŸºæœ¬ãƒªã‚¹ãƒˆã‚’å—ã‘å–ã‚Šã€ãã‚Œãã‚Œã®å•é¡Œã«ã¤ã„ã¦
    [é€šå¸¸ç‰ˆ, é€†å¼•ãç‰ˆ, æ­£èª¤ç‰ˆ, ãƒ¡ã‚¿ç‰ˆ] ã®ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç”Ÿæˆã—ã¦ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã™ã‚‹ã€‚
    æˆ»ã‚Šå€¤: { topic_id: [question_dict, question_dict, ...], ... }
    """
    groups = {}
    
    for i, item in enumerate(base_list):
        topic_id = i
        variations = []
        
        # 1. é€šå¸¸å•é¡Œ
        variations.append({
            "type": "normal",
            "category": item["c"],
            "question": item["q"],
            "answer": item["a"],
            "options": item["o"],
            "explanation": item["e"]
        })
        
        # 2. é€†å¼•ãå•é¡Œï¼ˆç­”ãˆãŒé¸æŠè‚¢ã«å«ã¾ã‚Œã‚‹å ´åˆã®ã¿ä½œæˆå¯èƒ½ï¼‰
        if item["a"] in item["o"]:
            new_q = f"æ¬¡ã®ã†ã¡ã€ã€Œ{item['a']}ã€ãŒæ­£è§£ã¨ãªã‚‹è³ªå•ã¯ã©ã‚Œï¼Ÿ"
            wrong_questions = [x["q"] for x in base_list if x["q"] != item["q"] and x["a"] != item["a"]]
            if len(wrong_questions) >= 3:
                opts = random.sample(wrong_questions, 3) + [item["q"]]
                random.shuffle(opts)
                variations.append({
                    "type": "reverse",
                    "category": f"{item['c']}ï¼ˆé€†å¼•ï¼‰",
                    "question": new_q,
                    "answer": item["q"],
                    "options": opts,
                    "explanation": f"ã€Œ{item['q']}ã€ã®ç­”ãˆãŒã€Œ{item['a']}ã€ã§ã™ã€‚"
                })

        # 3. æ­£èª¤å•é¡Œï¼ˆTrueãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰
        variations.append({
            "type": "tf_true",
            "category": f"{item['c']}ï¼ˆæ­£èª¤ï¼‰",
            "question": f"UPRã«é–¢ã™ã‚‹è¨˜è¿°ã¨ã—ã¦æ­£ã—ã„ã‹ï¼Ÿ\nã€Œ{item['q']}ã®ç­”ãˆã¯ã€{item['a']}ã€ã§ã‚ã‚‹ã€‚ã€",
            "answer": "æ­£ã—ã„",
            "options": ["æ­£ã—ã„", "èª¤ã‚Š"],
            "explanation": item["e"]
        })

        # 4. æ­£èª¤å•é¡Œï¼ˆFalseãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰
        wrong_answers = [x for x in item["o"] if x != item["a"]]
        if wrong_answers:
            fake_ans = random.choice(wrong_answers)
            variations.append({
                "type": "tf_false",
                "category": f"{item['c']}ï¼ˆæ­£èª¤ï¼‰",
                "question": f"UPRã«é–¢ã™ã‚‹è¨˜è¿°ã¨ã—ã¦æ­£ã—ã„ã‹ï¼Ÿ\nã€Œ{item['q']}ã®ç­”ãˆã¯ã€{fake_ans}ã€ã§ã‚ã‚‹ã€‚ã€",
                "answer": "èª¤ã‚Š",
                "options": ["æ­£ã—ã„", "èª¤ã‚Š"],
                "explanation": f"æ­£ã—ãã¯ã€Œ{item['a']}ã€ã§ã™ã€‚\n{item['e']}"
            })
            
        groups[topic_id] = variations
        
    return groups

# ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã•ã‚ŒãŸå•é¡Œãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆ
QUESTION_GROUPS = create_question_groups(BASE_QUESTIONS)

# 1å›ã®ã‚¯ã‚¤ã‚ºã®å•é¡Œæ•°
NUM_QUESTIONS_PER_QUIZ = 10 

# --- 3. Streamlit ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç† ---

def init_game():
    """ã‚²ãƒ¼ãƒ ã®åˆæœŸåŒ–å‡¦ç†"""
    st.session_state["score"] = 0
    st.session_state["current_q_index"] = 0
    st.session_state["finished"] = False
    st.session_state["answered"] = False 
    st.session_state["user_choice"] = None
    
    # --- é‡è¦ï¼šé‡è¤‡ãªã—ã®å‡ºé¡Œãƒ­ã‚¸ãƒƒã‚¯ ---
    # 1. ã¾ãšã€Œãƒã‚¿ï¼ˆTopic IDï¼‰ã€ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«10å€‹é¸ã¶
    #    â†’ ã“ã‚Œã«ã‚ˆã‚Šã€åŒã˜ãƒã‚¿ãŒ1å›ã®ã‚¯ã‚¤ã‚ºã§é‡è¤‡ã—ã¦å‡ºã‚‹ã®ã‚’é˜²ã
    total_topics = list(QUESTION_GROUPS.keys())
    selected_topic_ids = random.sample(total_topics, min(len(total_topics), NUM_QUESTIONS_PER_QUIZ))
    
    quiz_questions = []
    for tid in selected_topic_ids:
        # 2. é¸ã°ã‚ŒãŸãƒã‚¿ã®ä¸­ã‹ã‚‰ã€ãƒ©ãƒ³ãƒ€ãƒ ã«ã€Œ1ã¤ã®å½¢å¼ã€ã‚’é¸ã¶
        #    â†’ ã‚ã‚‹æ™‚ã¯ã€Œé€šå¸¸å•é¡Œã€ã€ã‚ã‚‹æ™‚ã¯ã€Œæ­£èª¤å•é¡Œã€ãŒå‡ºé¡Œã•ã‚Œã‚‹
        variations = QUESTION_GROUPS[tid]
        chosen_q = random.choice(variations)
        quiz_questions.append(chosen_q)
    
    # å‡ºé¡Œé †åºã‚’ã‚·ãƒ£ãƒƒãƒ•ãƒ«ï¼ˆåˆ†é‡ãŒå›ºã¾ã‚‰ãªã„ã‚ˆã†ã«ï¼‰
    random.shuffle(quiz_questions)
    
    st.session_state["questions"] = quiz_questions

if "questions" not in st.session_state:
    init_game()

# --- 4. UI/ãƒ‡ã‚¶ã‚¤ãƒ³ ---

with st.sidebar:
    st.markdown("## ğŸšš UPRã‚¯ã‚¤ã‚ºã‚¢ãƒ—ãƒª")
    # ã‚¹ãƒˆãƒƒã‚¯æ•°ã®æ¦‚ç®—ã‚’è¡¨ç¤ºï¼ˆãƒˆãƒ”ãƒƒã‚¯æ•° Ã— ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³å¹³å‡3ã€œ4ï¼‰
    total_variations = sum(len(v) for v in QUESTION_GROUPS.values())
    st.caption(f"åéŒ²ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³: å…¨ {total_variations} ãƒ‘ã‚¿ãƒ¼ãƒ³")
    
    if not st.session_state["finished"]:
        current = st.session_state["current_q_index"]
        total = len(st.session_state["questions"])
        
        st.subheader(f"Q. {current + 1} / {total}")
        st.progress((current) / total if total > 0 else 0)
        st.metric("SCORE", f"{st.session_state['score']} ç‚¹")
        
    if st.button("ğŸ”„ æœ€åˆã‹ã‚‰ã‚„ã‚Šç›´ã™", key="restart_btn"):
        init_game()
        st.rerun()

# --- 5. ãƒ¡ã‚¤ãƒ³ç”»é¢ ---

if st.session_state["finished"]:
    st.balloons()
    score = st.session_state["score"]
    total = len(st.session_state["questions"])
    
    st.markdown("<h1 style='color:#004098;'>çµæœç™ºè¡¨ï¼</h1>", unsafe_allow_html=True)
    st.markdown(f"### ã‚ãªãŸã®ã‚¹ã‚³ã‚¢: **{score} / {total}**")
    
    if score == total:
        st.success("ğŸ† ãƒ‘ãƒ¼ãƒ•ã‚§ã‚¯ãƒˆï¼ åˆ†é‡ã‚’å•ã‚ãšå®Œç’§ãªçŸ¥è­˜ã§ã™ï¼")
    elif score >= total * 0.7:
        st.info("ğŸ‘ ãŠè¦‹äº‹ï¼ UPRãƒã‚¹ã‚¿ãƒ¼ã¸ã®é“ã¯è¿‘ã„ã§ã™ã€‚")
    else:
        st.warning("ğŸ’ª ã¾ã ã¾ã ä¼¸ã³ä»£ãŒã‚ã‚Šã¾ã™ï¼ è‰²ã€…ãªå½¢å¼ã®å•é¡Œã«æ…£ã‚Œã¾ã—ã‚‡ã†ã€‚")
    
    st.markdown("---")
    if st.button("ğŸ”¥ æ–°ã—ã„å•é¡Œã«æŒ‘æˆ¦ã™ã‚‹", use_container_width=True):
        init_game()
        st.rerun()

else:
    # å•é¡Œè¡¨ç¤º
    idx = st.session_state["current_q_index"]
    q_data = st.session_state["questions"][idx]
    
    # ã‚«ãƒ†ã‚´ãƒªãƒãƒƒã‚¸ï¼ˆè‰²åˆ†ã‘ï¼‰
    cat_color = "#004098" # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆUPRãƒ–ãƒ«ãƒ¼
    if "æ­£èª¤" in q_data["category"]:
        cat_color = "#E65100" # ã‚ªãƒ¬ãƒ³ã‚¸
    elif "é€†å¼•" in q_data["category"]:
        cat_color = "#1B5E20" # ã‚°ãƒªãƒ¼ãƒ³
        
    st.markdown(f"<span style='background-color:{cat_color}; color:white; padding:4px 8px; border-radius:4px; font-size:0.8em;'>{q_data['category']}</span>", unsafe_allow_html=True)
    st.markdown(f"### Q{idx + 1}. {q_data['question']}")
    
    st.markdown("---")

    # é¸æŠè‚¢ãƒœã‚¿ãƒ³
    choices_container = st.container()
    with choices_container:
        cols = st.columns(1)
        
        for i, option in enumerate(q_data["options"]):
            # å›ç­”æ¸ˆã¿ã‹ã©ã†ã‹ã§ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹ã‚’å¤‰ãˆã‚‹
            if not st.session_state["answered"]:
                if st.button(option, key=f"opt_{idx}_{i}", use_container_width=True):
                    # æ­£è§£åˆ¤å®šã¨ã‚¹ã‚³ã‚¢åŠ ç®—
                    is_correct = (option == q_data["answer"])
                    if is_correct:
                        st.session_state["score"] += 1
                    
                    st.session_state["user_choice"] = option
                    st.session_state["answered"] = True
                    st.rerun()
            else:
                st.button(option, key=f"opt_{idx}_{i}", use_container_width=True, disabled=True)

    # å›ç­”å¾Œã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
    if st.session_state["answered"]:
        st.markdown("---")
        user_choice = st.session_state["user_choice"]
        
        if user_choice == q_data["answer"]:
            st.success(f"â­• æ­£è§£ï¼")
        else:
            st.error(f"âŒ ä¸æ­£è§£... ï¼ˆå›ç­”: {user_choice}ï¼‰")
            
        st.markdown(f"##### æ­£è§£: **{q_data['answer']}**")
        st.info(f"ğŸ’¡ **è§£èª¬:**\n{q_data['explanation']}")
        
        st.markdown("<br>", unsafe_allow_html=True)
        
        # æ¬¡ã¸ãƒœã‚¿ãƒ³
        if idx + 1 >= len(st.session_state["questions"]):
            if st.button("çµæœã‚’è¦‹ã‚‹ â¡ï¸", type="primary", use_container_width=True):
                st.session_state["finished"] = True
                st.rerun()
        else:
            if st.button("æ¬¡ã®å•é¡Œã¸ â¡ï¸", type="primary", use_container_width=True):
                st.session_state["current_q_index"] += 1
                st.session_state["answered"] = False
                st.session_state["user_choice"] = None
                st.rerun()